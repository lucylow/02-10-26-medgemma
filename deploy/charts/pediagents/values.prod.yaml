# Production example â€” GKE/EKS with GPU nodepool and IRSA hints.
# Use with: helm upgrade --install pediscreen . -n pediscreen -f values.yaml -f values.prod.yaml
# Replace placeholders; use ExternalSecrets / Vault for secrets. For EKS, annotate the chart ServiceAccount with IRSA IAM role.

namespace: pediscreen

global:
  imagePullPolicy: IfNotPresent
  imagePullSecrets: []   # e.g. - name: ghcr-regcred
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "4Gi"

agents:
  orchestrator:
    enabled: true
    replicas: 3
    image:
      repository: ghcr.io/lucylow/pediscreen-orchestrator
      tag: "v0.2.0"
    port: 8080
    resources:
      requests:
        cpu: "500m"
        memory: "1Gi"
      limits:
        cpu: "2"
        memory: "4Gi"
    env: []
    nodeSelector: {}
    tolerations: []
    gpu:
      enabled: false
    hpa:
      enabled: true
      minReplicas: 2
      maxReplicas: 6
      targetCPUUtilizationPercentage: 55

  embedder:
    enabled: true
    replicas: 2
    image:
      repository: ghcr.io/lucylow/pediscreen-embedder
      tag: "v0.2.0"
    port: 8000
    resources:
      requests:
        cpu: "1"
        memory: "2Gi"
      limits:
        cpu: "2"
        memory: "6Gi"
    env: []
    nodeSelector: {}
    tolerations: []
    gpu:
      enabled: false
    hpa:
      enabled: false

  modelreasoner:
    enabled: true
    replicas: 1
    image:
      repository: ghcr.io/lucylow/pediscreen-modelreasoner
      tag: "v0.2.0"
    port: 8000
    resources:
      requests:
        cpu: "4000m"
        memory: "32Gi"
      limits:
        cpu: "8000m"
        memory: "64Gi"
    env: []
    nodeSelector:
      accelerator: nvidia-gpu
    tolerations:
      - key: "nvidia.com/gpu"
        operator: "Exists"
        effect: "NoSchedule"
    gpu:
      enabled: true
      resourceName: nvidia.com/gpu
      count: 1
    hpa:
      enabled: false

  audit:
    enabled: true
    replicas: 2
    image:
      repository: ghcr.io/lucylow/pediscreen-audit
      tag: "v0.2.0"
    port: 8080
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "1Gi"
    hpa:
      enabled: false

  registry:
    enabled: true
    replicas: 1
    image:
      repository: ghcr.io/lucylow/pediscreen-registry
      tag: "v0.2.0"
    port: 8080
    resources:
      requests:
        cpu: "200m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "1Gi"
    hpa:
      enabled: false

  ui:
    enabled: true
    replicas: 2
    image:
      repository: ghcr.io/lucylow/pediscreen-ui
      tag: "v0.2.0"
    port: 3000
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
    hpa:
      enabled: true
      minReplicas: 2
      maxReplicas: 10
      targetCPUUtilizationPercentage: 70

ingress:
  enabled: true
  className: gce   # or nginx depending on cluster
  hostname: pediscreen.prod.example.org
  annotations: {}
  tls:
    enabled: true
    secretName: pediscreen-prod-tls

prometheus:
  enabled: true
  serviceMonitor:
    enabled: true

rbac:
  create: true
serviceAccount:
  create: true

# Do not put real secrets here. Use ExternalSecrets or Vault.
secrets: {}

# Production tips:
# - Configure ExternalSecrets to fetch DB and API keys from GCP Secret Manager / AWS Secrets Manager.
# - EKS: create IAM role for service account (IRSA) and annotate the ServiceAccount for S3/KMS access.
# - GKE: use Workload Identity for GCP resource access.
